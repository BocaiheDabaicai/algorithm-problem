# 渲染页面：浏览器的工作原理

影响web性能的两大原因

1. 等待资源加载

2. 单线程运行

#### 加载web页面的第一步：导航

1. DNS查询

网站地址会定位到对应的IP地址，再获取到web资源

如果是第一次访问网站，则需要查询DNS服务器，获取IP地址

如果网站里的每种资源都是一个网站地址，那么需要进行多次查询，才能定位所有资源的IP地址

2. TCP握手

浏览器通过TCP三次握手与服务器建立TCP连接

3. TLS协商

浏览器与服务器建立https安全连接，需要再进行一次握手，往返五次

#### 加载web页面的第二步：响应

1. 拥塞控制/TCP慢启动

TCP数据包会分成若干段进行传输，浏览器每接收到一个数据段，就需要发送ack给服务器

为了在网络通畅时尽可能增加传输段数量、网络拥堵时尽可能减少传输段数量，就使用CWND(拥塞窗口)控制传输段数量，CWND越大，传输段数量越大

收到ACK之后，CWND会加倍；没有收到ACK，CWND会减半

#### 加载web页面的第三步：解析

1. 构建DOM树

获取HTML标签，并解析为DOM树

CSS文件、图片资源不会阻碍解析过程，脚本标签需要注意

2. 预加载扫描器

扫描预加载资源（图片、脚本等等），同时防止js无法读取DOM元素及CSS样式

3. 构建CSSOM树

一棵独立的树，用于映射DOM树上每个元素所使用的样式

构建快速，总时间小于一次DNS查询时间

4. 其他过程 

js会在树构建的过程中，进行资源下载；脚本会被解析为抽象语法树，输入编译器、输出字节码（JS编译）

构建AOM，支持屏幕阅读器访问浏览器内容（构建无障碍树）




